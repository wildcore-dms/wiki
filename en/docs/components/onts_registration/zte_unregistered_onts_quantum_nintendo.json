{"template":"conf t\n{% if  onu.interface._technology == 'gpon' %}\n{% if  device.model.key == 'zte_c320_fw_1_2' or device.model.key == 'zte_c300_fw_1_2'%}\n  interface {{onu.interface.iface_name}}\n  onu {{free_onu_numbers.first}} type {{params.type_ont}} sn {{onu.serial}}\n  exit\ninterface gpon-onu_{{onu.interface._shelf}}/{{onu.interface._slot}}/{{onu.interface._port}}:{{free_onu_numbers.first}}\n  name {{params.device_name_custom}}\n  description {{params.device_name_custom}}\n  tcont 1 name T-INET profile UP-500MB\n  gemport 1 name G-INET unicast tcont 1 dir both\n  gemport 1 traffic-limit downstream DOWN-500MB\n  max-mac-learn {{params.max_mac}} vport 1\n  security storm-control broadcast rate 30 direction ingress vport 1\n  switchport mode hybrid vport 1\n  ip dhcp snooping enable vport 1\n{% if  params.mode_port1_onu == 'acess' %}\n  service-port 1 vport 1 user-vlan {{params.vlan1_port1_onu}} vlan {{params.vlan1_port1_onu}}\n  port-location format flexible-syntax sport 1\n  ip-service ip-source-guard enable sport 1\n  dhcp-option82 enable sport 1\n  dhcp-option82 trust true replace sport 1\n  exit\npon-onu-mng gpon-onu_{{onu.interface._shelf}}/{{onu.interface._slot}}/{{onu.interface._port}}:{{free_onu_numbers.first}}\n  gemport 1 flow 1\n  loop-detect ethuni eth_0/1 enable\n  vlan port eth_0/1 mode tag vlan {{params.vlan1_port1_onu}}\n  exit\n{% endif %}  \n{% if  params.mode_port1_onu == 'tag' and params.vlan1_port1_onu > \"\" %}\n  service-port 1 vport 1 user-vlan {{params.vlan1_port1_onu}} vlan {{params.vlan1_port1_onu}}\n  port-location format flexible-syntax sport 1\n  dhcp-option82 enable sport 1\n  dhcp-option82 trust true keep sport 1\n{% if  params.mode_port1_onu == 'tag' and params.vlan2_port1_onu > \"\" %}\n  service-port 2 vport 1 user-vlan {{params.vlan2_port1_onu}} vlan {{params.vlan2_port1_onu}}\n  port-location format flexible-syntax sport 2\n  dhcp-option82 enable sport 2\n  dhcp-option82 trust true keep sport 2\n{% endif %} \n exit\n  pon-onu-mng gpon-onu_{{onu.interface._shelf}}/{{onu.interface._slot}}/{{onu.interface._port}}:{{free_onu_numbers.first}}\n  gemport 1 flow 1\n  loop-detect ethuni eth_0/1 enable\n  vlan port eth_0/1 mode transparent\n{% endif %}\n\n{% if  params.type_ont == 'GPON_FOUR' and params.mode_port1_onu == 'acess' %}\n  service-port 1 vport 1 user-vlan {{params.vlan1_port1_onu}} vlan {{params.vlan1_port1_onu}}\n{% endif %}\n{% if  params.type_ont == 'GPON_FOUR' and params.mode_port2_onu == 'acess' %}\n  service-port 2 vport 1 user-vlan {{params.vlan1_port2_onu}} vlan {{params.vlan1_port2_onu}}\n{% endif %}\n\n{% if  params.type_ont == 'GPON_FOUR_WIFI' %}\n  service-port 1 vport 1 user-vlan {{params.vlan1_port1_onu}} vlan {{params.vlan1_port1_onu}}\n  service-port 1 description HSI\n  security storm-control broadcast rate 20 direction egress vport 1\n  security storm-control broadcast rate 20 direction ingress vport 1\n  ip dhcp snooping enable vport 1\n  ip-source-guard enable sport 1\nexit\npon-onu-mng {{onu.interface.name}}\n  loop-detect ethuni eth_0/1 enable\n  loop-detect ethuni eth_0/2 enable\n  loop-detect ethuni eth_0/3 enable\n  loop-detect ethuni eth_0/4 enable\n  flow mode 1 tag-filter vlan-filter untag-filter discard\n  flow 1 pri 0 vlan {{params.vlan1_port1_onu}}\n  gemport 1 flow 1\n  switchport-bind switch_0/1 iphost 1\n  ip-host 1 dhcp-enable enable ping-response enable traceroute-response enable\n  vlan-filter-mode iphost 1 tag-filter vlan-filter untag-filter discard\n  vlan-filter iphost 1 pri 0 vlan {{params.vlan1_port1_onu}}\n  dhcp-ip ethuni eth_0/1 from-onu\n  dhcp-ip ethuni eth_0/2 from-onu\n  dhcp-ip ethuni eth_0/3 from-onu\n  dhcp-ip ethuni eth_0/4 from-onu\n{% endif %}\n{% endif %}\n{% endif %}\nend\nwrite","templates":{"epon":"test","gpon":"<TEMPLATE GRPON>","registration":{"epon":"conf t\ninterface epon-olt_1/{{onu.interface.slot}}/{{onu.interface.port}}\nonu {{params.reg_number}} type 1GE_EPON mac  {{onu.mac}}\n!\npon-onu-mng epon-onu_1/1/1:9\nvlan port eth_0/1 mode tag vlan 4078 priority 0\ninterface-loopdetect eth_0/1 activate\n!\ninterface epon-onu_1/{{onu.interface.slot}}/{{onu.interface.port}}:{{params.reg_number}}\n  property description {{params.description}}\n  sla-profile 100MB vport 1\n  service-port 1 vport 1 user-vlan {{device.params.user_vlan_id}} vlan {{device.params.user_vlan_id}}\n  ip dhcp snooping enable vport 1\n  ip access-group 300 in vport 1\n!\nend\nwr","gpon":"<TEMPLATE GRPON>"}},"parameters":[{"key":"description","meta":{"default_value":"agreement","source_parameter_key":""},"type":"input_string","value":"","visible":"Описание(номер договора)","visible_for":"all"},{"key":"reg_number","meta":{"default_value":"","source_parameter_key":"free_onu_numbers.all"},"type":"select_from_variable","value":"","visible":"Номер ОНУ","visible_for":"all"},{"key":"profile_remote","meta":{"default_value":"","source_parameter_key":"profiles.remote"},"type":"select_from_variable","value":"","visible":"Remote профайл","visible_for":"gpon"},{"key":"profile_line","meta":{"default_value":"","source_parameter_key":"profiles.line"},"type":"select_from_variable","value":"","visible":"Line профайл","visible_for":"gpon"}],"parameters_v2":[{"key":"type_ont","name":"Тип ONU","type":"select_from_predefined","order":0,"value":"","required":false,"visible_if":"user.role.id < 0","regular_expr":"","default_value":"onu.interface.name","variants_list":"GPON_ONE\nGPON_FOUR","source_parameter_key":"device.description"},{"key":"mode_port1_onu","name":"1й порт отдаем тегом или аксесом?","type":"select_from_predefined","order":1,"value":"","required":false,"visible_if":"user.role.id < 0","regular_expr":"","default_value":"","variants_list":"acess\ntag","source_parameter_key":""},{"key":"vlan1_port1_onu","name":"1 порт ONU. VLAN1","type":"input_variable","order":2,"value":"","required":false,"visible_if":"user.role.id < 0","regular_expr":"","default_value":"","variants_list":"","source_parameter_key":"device.params.default_vlan"},{"key":"vlan2_port1_onu","name":"1 порт ONU. VLAN2","type":"input_variable","order":3,"value":"","required":false,"visible_if":"params.mode_port1_onu == 'tag' && user.role.id < 0","regular_expr":"","default_value":"","variants_list":"","source_parameter_key":"device.params.default_vlan"},{"key":"mode_port2_onu","name":"2й порт отдаем тегом или аксесом?","type":"select_from_predefined","order":4,"value":"","required":false,"visible_if":"params.type_ont == 'GPON_FOUR' && user.role.id < 0","regular_expr":"","default_value":"","variants_list":"acess\ntag","source_parameter_key":""},{"key":"vlan1_port2_onu","name":"2 порт ONU. VLAN1","type":"input_variable","order":5,"value":"","required":false,"visible_if":"params.type_ont == 'GPON_FOUR' && user.role.id < 0","regular_expr":"","default_value":"","variants_list":"","source_parameter_key":"device.params.default_vlan"},{"key":"vlan2_port2_onu","name":"2 порт ONU. VLAN2","type":"input_variable","order":6,"value":"","required":false,"visible_if":"params.type_ont == 'GPON_FOUR' && params.mode_port2_onu == 'tag' && user.role.id < 0","regular_expr":"","default_value":1,"variants_list":"","source_parameter_key":"device.params.default_vlan"},{"key":"mode_port3_onu","name":"3й порт отдаем тегом или аксесом?","type":"select_from_predefined","order":7,"value":"","required":false,"visible_if":"params.type_ont == 'GPON_FOUR' && user.role.id < 0","regular_expr":"","default_value":"","variants_list":"acess\ntag","source_parameter_key":""},{"key":"vlan1_port3_onu","name":"3 порт ONU. VLAN1","type":"input_variable","order":8,"value":"","required":false,"visible_if":"params.type_ont == 'GPON_FOUR' && user.role.id < 0","regular_expr":"","default_value":"","variants_list":"","source_parameter_key":"device.params.default_vlan"},{"key":"vlan2_port3_onu","name":"3 порт ONU. VLAN2","type":"input_variable","order":9,"value":"","required":false,"visible_if":"params.type_ont == 'GPON_FOUR' && params.mode_port3_onu == 'tag' && user.role.id < 0","regular_expr":"","default_value":"","variants_list":"","source_parameter_key":"device.params.default_vlan"},{"key":"mode_port4_onu","name":"4й порт отдаем тегом или аксесом?","type":"select_from_predefined","order":10,"value":"","required":false,"visible_if":"params.type_ont == 'GPON_FOUR' && user.role.id < 0","regular_expr":"","default_value":"","variants_list":"acess\ntag","source_parameter_key":""},{"key":"vlan1_port4_onu","name":"4 порт ONU. VLAN1","type":"input_variable","order":11,"value":"","required":false,"visible_if":"params.type_ont == 'GPON_FOUR' && user.role.id < 0","regular_expr":"","default_value":"","variants_list":"","source_parameter_key":"device.params.default_vlan"},{"key":"vlan2_port4_onu","name":"4 порт ONU. VLAN2","type":"input_variable","order":12,"value":"","required":false,"visible_if":"params.type_ont == 'GPON_FOUR' && params.mode_port4_onu == 'tag' && user.role.id < 0","regular_expr":"","default_value":"","variants_list":"","source_parameter_key":"device.params.default_vlan"},{"key":"max_mac","name":"Кол-во маков на ONU 1-4095","type":"input_string","order":13,"value":"","required":false,"visible_if":"user.role.id < 0","regular_expr":"","default_value":5,"variants_list":"","source_parameter_key":""},{"key":"device_name_custom","name":"Описание ONU","type":"input_variable","order":14,"value":"","required":false,"visible_if":"","regular_expr":"","default_value":"onu.interface.name","variants_list":"3518\n3519\n3520","source_parameter_key":"device.description"}]}