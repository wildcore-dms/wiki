# Опитувач обладнання (poller)
Опитувальник обладнання працює на тлі і збирає деяку інформацію з обладнання.
За замовчуванням працює 10 екземплярів збирача. Це означає, що одночасно дані можуть бути зібрані з 10 різних пристроїв.

## Для чого потрібний?
Дані, отримані з обладнання опитувальником, використовуються для:

* Актуалізації кешів - для швидшого завантаження сторінки
* Збору історичних даних - наприклад, побудова графіків сигналу
* Генерації подій та повідомлень на їх основі
* Відправлення метрик в Prometheus

## Список поллерів
* **arp_table** - ARP таблиця
* **bgp_sessions** - список BGP сесій
* **counters** - лічильники з інтерфейсів (помилки, трафік)
* **fdb_table** - FDB-таблиця
* **interfaces_list** - список інтерфейсів з їх іменами та описом
* **interfaces_status** - адмін-статус/поточний стан
* **ont_ident** - ідентифікатори ОНУ (серійні номери/MAC-адреси)
* **optical_strength** - рівні сигналу з ону (RX,TX,OLT-RX,відстань до ОНУ,температура)
* **system** - в даний момент збирається тільки аптайм пристрою
* **sys_resources** - утилізація CPU/утилізація пам'яті

## Налаштування опитувальника
### Зміна інтервалів опитування та полерів за моделлю пристрою
У системі є можливість змінити інтервали опитування (у секундах), а також відключити деякі опитувальники.
![](../assets/device_models.png)
![](../assets/edit-device-model.png)

1. Дефолтні налаштування полерів
2. Вимкніть цей параметр, щоб змінити полери
3. Ім'я полера
4. Увімкнути/вимкнути поллер
5. Інтервал за секунди

Після зміни збережіть зміни у системі.

### Зміна інтервалів опитування та полерів з пристрою
Також є можливість переписати налаштування полерів для конкретного пристрою. Має сенс, наприклад, якщо у вас є кілька олт з невеликою кількістю ОНУ, і один, цієї моделі, "забитий" під зав'язку.
![](../assets/edit_device_pollers.png)
Налаштування блоку полерів аналогічне налаштуванню моделі пристрою.

### Виключення збору даних за певними портами
Зміна стосується збереження даних по полерах:

* counters
* interfaces_status (для деяких моделей)
* optical_strength

![](../assets/edit_interfaces_poll.png)

1. ID інтерфейсів у системі
2. Ім'я інтерфейсу
3. Увімкнення/вимкнення збереження метрик за інтерфейсом

_Варто враховувати, що відключення портів впливає лише збереження метрик, але з їх збір з устаткування(фактично збір відбувається з усіх интерфесов у разі)_


### Зміна кількості екземплярів працюючих опитувальників
Ви можете вказати необхідну кількість працюючих екземплярів через параметр **POLLER_COUNT_PROCS** (у файлі /opt/wildcore-dms/.env або через веб-інтерфейс, в налаштуваннях системи).

Кількість примірників має сенс збільшувати, якщо ви помітили, що інтервал збору даних з обладнання набагато більше зазначеного інтервалу за моделлю/пристроєм.

Рекомендації щодо встановлення максимального значення кількості екземплярів:

* _На основі RAM:_ (всього пам'яті - 3,5Gb) / 0,25Gb = макс кількість
* _На основі CPU:_ 2,5 * кількість ядер = макс кількість


### Відключення спроб збору з недоступного обладнання
Якщо параметр **POLLER_IGNORE_DOWN** із встановленим значенням _true_ - перед початком роботи з обладнанням буде перевірятись його доступність по ICMP.

