# Приклади шаблонів Twig

!!! abstract "Огляд"
    Ця сторінка представляє кілька простих **Макросів**, надісланих нашими користувачами, разом з поясненнями.

    Ви можете скопіювати їх та спробувати!

!!! warning "Увага"
    Команди можуть відрізнятися, залежно від пристроїв, що ви використовуєте.

    Відповідні команди, див. у посібнику до вашого пристрою.

## Перегляд конфігурації ONU

Цей приклад демонструє простий **Шаблон** без **Параметрів**, який просто відображає інформацію.

### Загальне

!!! quote ""
    1. **Назва:** `Перегляд інформації ONU`
    2. **Опис:** *можете вказати детальний опис цього макросу*
    3. **Ролі:** *можете обрати належні для виконання цього макросу ****Ролі***
    4. **Фільтр за виробником:** Для цілей цієї демонстрації, ми оберемо виробника `ZTE`
    5. **Моделі:** `ZTE C320`
    6. **Показувати для:** `ONU`
    7. **Відображення результатів:** `Усі команди`

### **Параметри**

Для цієї демонстрації нам не потрібні **Параметри**, тому ми пропускаємо цю вкладку.

### **Шаблон**

!!! quote ""
    1. **Пристрій** та **Інтерфейс:** *можете обрати ****Пристрій**** та/або ****Інтерфейс****, що підходять для виконання цього макросу*
    2. **Форма Параметрів:** З огляду на те, що ми не маємо жодних параметрів, цей розділ не відображається.
    3. **Змінні:** Тут можна побачити змінні, отримані з **Пристрою** та **Інтерфейсу**.
    4. **Блок шаблону:**

        - **Обраний шаблон:**

            ``` twig linenums="1"
            show run int {{iface.name}}
            show onu conf {{iface.name}}
            ```

            ???+ info "Інформація"
                Це текстове поле, яке визначає ваш макрос. Воно містить конкретні CLI команди, що будуть виконуватись на обраному **Пристрої** та/або **Інтерфейсі**, у поєднанні з будь-якими параметрами або змінними, де це доречно.

                Тут ми використовуємо змінну `iface`, яку надав нам обраний **Пристрій**.

        - **Результат:**

            ``` shell 
            show run int epon-onu_1/1/1:1
            show onu run conf epon-onu_1/1/1:1
            ```

            ???+ info
                Тут ви можете побачити результат компіляції **Шаблону**, конкретні команди, що будуть виконані на вашому пристрої.

                Для цілей цієї демонстрації, ми обрали пристрій `ZTE C320` та інтерфейс `epon-onu_1/1/1:1`.
                
                Наша змінна `{{iface.name}}` отримала значення `epon-onu_1/1/1:1` а інші статичні команди були залишені без змін.

Натисніть кнопку **Створити** і ваш макрос готовий до використання.

### Виконання макросу

Перейдіть до пристрою та його інтерфейсу, застосовного до цього макросу, і знайдіть макрос, який ми щойно створили, у вкладці **Макроси**.

!!! tip "Підказка"
    Так як ми обрали `ONU` у полі **Відображати для**, цей макрос буде відображений лише на відповідному екрані.

Для цієї демонстрації ми обрали **Пристрій** `ZTE 320` і його **Інтерфейс** `gpon-onu_1/2/1:1`.

![](../../assets/macros/twig_examples_onu_screen_display_config.png)

Так як ми не вказали жодних **Параметрів** для цього макросу, відповідне повідомлення **Цей макрос не має параметрів** відображається натомість.

Коли ви натиснете кнопку **Попередній перегляд**, ви можете побачити, що вона працює так само як поле **Результат** у вкладці **Шаблон** на сторінці створення макросу.

![](../../assets/macros/twig_examples_onu_display_config_preview_executed_commands.png)

Кнопка **Виконати** відправляє команди до обраного інтерфейсу пристрою, у нашому випадку це `gpon-onu_1/2/1:1` .

![](../../assets/macros/twig_examples_display_config_results.png)




## Зміна обмеження швидкості

### Загальне

Fill out this tab according to your requirements.

??? example
    1. **Назва:** `Зміна обмеження швидкості`
    2. **Опис:** `Оберіть обмеження швидкості у випадаючому списку, яке буде застосовано до з'єднання клієнта `
    3. **Ролі:** `Оператор`
    4. **Фільтр за виробником:** `ZTE`
    5. **Моделі:** `ZTE C320`
    6. **Показувати для:** `ONU`
    7. **Відображення результатів:** `Усі команди`

### Параметри

!!! quote ""
    1. Додайте новий **Параметр**.
    2. **Властивість:** `speed`
    3. **Відображувана назва властивості:** `Швидкість`
    4. **Обов'язковий:** `Ні`
    5. **Тип параметру:** `Випадний список з запропонованих`

        ???+ info "Інформація"
            Тут ми пропонуємо користувачу значення, для більш зручного вибору правильного.

    6. **Список запропонованих значень:**
        ``` linenums="1"
        100MB
        1GB
        ```
    7. **Умови видимості:** *залишимо це поле порожнім*

### Шаблон

!!! quote ""
    1. **Пристрій** та **Інтерфейс:** *можете обрати ****Пристрій**** та/або ****Інтерфейс****, що підходять для виконання цього макросу*
    2. **Форма Параметрів:** Тут ми маємо випадний список для параметру **Швидкість** з попередньої вкладки.
    3. **Змінні:** Тут можна побачити змінні, отримані з **Пристрою** та **Інтерфейсу**, а також властивість `params`, що зберігає значення параметрів, обраних вище.
    4. **Блок шаблону:**

        - **Обраний шаблон:** 
            ``` twig linenums="1"
            conf t
            interface {{iface.name}}
            tcont 1 name T-INET profile UP-{{params.speed}}
            gemport 1 traffic-limit downstream DOWN-{{params.speed}}
            end
            wr
            ```

        - **Результат:**

            ``` shell
            conf t
            interface epon-onu_1/1/1:1
            tcont 1 name T-INET profile UP-100MB
            gemport 1 traffic-limit downstream DOWN-100MB
            end
            wr
            ```

            ???+ info
                Для цілей цієї демонстрації, ми обрали **Швидкість** `100MB` у випадному списку вище, а також пристрій `ZTE C320` і його інтерфейс `epon-onu_1/1/1:1`.

                Як і в попередньому прикладі, змінна `{{iface.name}}` отримала значення `epon-onu_1/1/1:1`, а `{{params.speed}}` зберіг значення, яке ми обрали у випадному списку **Швидкість**.

Цей макрос готовий до використання.

### Виконання макросу

Перейдіть до пристрою та його інтерфейсу, застосовного до цього макросу, і знайдіть макрос, який ми щойно створили, у вкладці **Макроси**.

!!! tip "Підказка"
    Так як ми обрали `ONU` у полі **Відображати для**, цей макрос буде відображений лише на відповідному екрані.

Для цієї демонстрації ми обрали **Пристрій** `ZTE 320` і його **Інтерфейс** `gpon-onu_1/1/1:1`.

![](../../assets/macros/twig_examples_onu_screen.png)

Цього разу ми можемо обрати бажану **Швидкість** з випадного меню. 

**Попередній перегляд:**

![](../../assets/macros/twig_examples_preview_executed_commands.png)

Кнопка **Виконати** відправляє команди до обраного інтерфейсу пристроя, на цей раз `epon-onu_1/1/1:1`.

!!! warning ""
    З міркувань безпеки, ми не будемо виконувати макрос у цій демонстрації.


## Керування VLAN

Цей макрос включає в себе білше **Параметрів**, у порівнянні з попередніми. 

За потреби, зверніться до сторінки [**Опції типів параметрів**](./parameter_type_options.md).

### Загальне

!!! quote ""
    1. **Назва:** `Керування VLAN`
    2. **Опис:** `Керування VLAN на вибраному порту`
    3. **Ролі:** `Інженер`
    4. **Фільтр за виробником:** `D-Link`
    5. **Моделі:** `D-Link DES-1228/ME ...` 
    
        *можете обрати більше підходящих пристроїв, ми використовуватимо цей для демонстрації*

    6. **Показувати для:** `Пристрій, Порт`
    7. **Відображення результатів:** `Усі команди`

### Параметри

!!! quote ""
    1.  Параметр **Дія**:
        - **Властивість:** `action`
        - **Відображувана назва властивості:** `Дія`
        - **Обов'язковий:** `Так`
        - **Тип параметру:** `Випадний список з запропонованих`
        - **Список запропонованих значень:**
            ``` linenums="1"
            Додати
            Видалити
            ```
        - **Умови видимості:** *залишаємо порожнім*

    2. Параметр **Тип**:
        - **Властивість:** `type`
        - **Відображувана назва властивості:** `Тип`
        - **Обов'язковий:** `Ні`
        - **Тип параметру:** `Випадний список з запропонованих`
        - **Список запропонованих значень:**
            ``` linenums="1"
            Untagged
            Tagged
            ```
        - **Умови видимості:**
            ``` linenums="1"
            params.action === 'Add'
            ```

            ??? info
                Тут ми звертаємося до попереднього параметру, **Дія**, і виставляємо відображення параметру **Тип**, лише коли вибраною дією є `'Додати'`.

    3. Параметр **VLAN**:
        - **Властивість:** `vlan`
        - **Відображувана назва властивості:** `VLAN`
        - **Обов'язковий:** `Так`
        - **Тип параметру:** `Випадний список зі змінних`
        - **Джерело значень:** `data.vlans`

            ??? info
                Ця змінна з пристрою зберігає масив об'єктів, властивості яких описують VLAN мережі, якими ми хочемо керувати.

        - **Умови видимості:** *залишаємо порожнім*
        - **Назва елементу:** `${item.name}  (${item.id})`

            ??? info
                Обираємо властивості VLAN `name` та `id` для показу у випадному списку для зручності.

    4. **Port** parameter:
        - **Властивість:** `port`
        - **Відображувана назва властивості:** `Port`
        - **Обов'язковий:** `False`
        - **Тип параметру:** `Випадний список зі змінних`
        - **Джерело значень:** `interfaces_list`
        - **Умови видимості:** `!iface`

            ??? info
                Ця умова приховує параметр з екранів, які надають змінну `iface`, такі як обрані інтерфейси.

                Таким чином, коли ми запускаємо цей макрос з екрану **Пристрою**, ми можемо обрати окремий інтерфейс з випадного списку, у іншому випадку цей параметр відсутній.

        - **Назва елементу:** `${item.name}`

### Шаблон

!!! quote ""
    1. **Пристрій** та **Інтерфейс:** *можете обрати ****Пристрій**** та/або ****Інтерфейс****, що підходять для виконання цього макросу*

        ??? info
            Для цієї демонстрації ми обрали пристрій `D-Link DES-1228/ME` і залишили поле **Інтерфейс** порожнім.

    2. **Форма Параметрів:** 

        Для цієї демонстрації ми обрали:

        - **Дія:** `Додати` 
        - **Тип:** `Untagged` 
        - **VLAN:** `sw802 (802)` 
        - **Порт**: `1/1`

        ??? info
            Тут представлені параметри, які ми створили у попередьному кроці.

            Випадний список **Тип** видимий лише коли параметр **Дія** встановлений на `Додати`, а **Порт** лише коли ми не обрали **Інтерфейс**.

    3. **Змінні:** 

        Тут можна побачити змінні, отримані з **Пристрою**, а також властивість `params`, що зберігає значення параметрів `action`, `type`, `vlan` і `port`, обраних вище.

        ``` json linenums="1"
        "params": {
            "action": "Add",
            "type": "Untagged",
            "vlan": {
                "name": "sw802",
                "id": "802",
                "ports": { /* 3 items */ },
                 "_display_name": "sw802 (802)"
            },
            "port": {
                "id": 5026,
                "type": "FE",
                "name": "1/1",
                "bind_key": "1",
                "status": "Down",
                "_display_name": "1/1"
            }
        }, 
        ```

        ??? info
            Властивість `_display_name` відповідає обчисленій змінній у полі **Назва елементу**, яке ми заповнили у попередньому кроці.

            Ми обрали `${item.name}` для параметру **Порт**, але могли б залишити пустим, так як це значення поля за замовчуванням.

    4. **Блок шаблону:**

        - **Обраний шаблон:** 
            ``` twig linenums="1"
            {# Блок оголошення і визначення змінних всередині шаблону #}
            {% set port = params.port %}
            {% if iface %}
            {% set port = iface %}
            {% endif %}

            {# Блок шаблону #}
            {% if params.action == 'Видалити' %}
            config vlan {{params.vlan.name}} delete {{port.bind_key}}
            {% else %}
            config vlan {{params.vlan.name}} add {{params.type | lower }} {{port.bind_key}}
            {% endif %}
            ```

        - **Результат:**
            ``` shell
            config vlan sw802 add untagged 1
            ```

Макрос готовий до використання.

### Виконання макросу

Перейдіть до пристрою або його інтерфейсу, застосовного до цього макросу, і знайдіть макрос, який ми щойно створили, у вкладці **Макроси**.

Для цієї демонстрації ми обрали **Пристрій** `D-Link DES-1228/ME`.

![](../../assets/macros/twig_examples_manage_vlan_parameters.png)

**Попередній перегляд:**

![](../../assets/macros/twig_examples_manage_vlan_preview.png)

**Виконання:**

![](../../assets/macros/twig_examples_manage_vlan_execution_success.png)